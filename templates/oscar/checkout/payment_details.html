
{% extends "oscar/checkout/checkout.html" %}
{% load i18n %}

{% block title %}
    {% trans "Payment details" %} | {{ block.super }}
{% endblock %}

{% block checkout_nav %}
    {% include 'oscar/checkout/nav.html' with step=3 %}
{% endblock %}

{% block checkout_title %}{% trans "Use one of the following payment method" %}{% endblock %}

{% block order_contents %}{% endblock %}
{% block shipping_address %}{% endblock %}
{% block shipping_method %}{% endblock %}
{% block payment_method %}{% endblock %}

{% block payment_details %}
    {% block payment_details_content %}
        <ul>
            
        </ul>
        <div id="paypal-button-container"></div>
        <a id="view_preview" href="{% url 'checkout:preview' %}" class="btn btn-outline-dark btn-lg">{% trans "Continue" %}</a>
        <script src="https://www.paypal.com/sdk/js?client-id=AfSSXg_k6UlnOnZBgTfYxqoNSleT5UCQo_n5FzprDQIjL-7QaHpzXnqgea-qnJr7jbZMeI-DdZ-Z9Iw7&currency=USD"></script>

        <script>
        console.log('working')
   
            function getCookie(name) {
               var cookieValue = null;
               if (document.cookie && document.cookie !== '') {
                   var cookies = document.cookie.split(';');
                   for (var i = 0; i < cookies.length; i++) {
                       var cookie = cookies[i].trim();
                       // Does this cookie string begin with the name we want?
                       if (cookie.substring(0, name.length + 1) === (name + '=')) {
                           cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                           break;
                       }
                   }
               }
               return cookieValue;
           }
           var csrftoken = getCookie('csrftoken');
   
            let total = '{{product.price}}'
           let total2 = total*10
           console.log(total2)
            var productId = '{{product.id}}'
   
            function completeOrder(){
                console.log('finish');
               
   
                fetch(url, {
                    method:'POST',
                    headers:{
                        'Content-type':'application/json',
                        'X-CSRFToken':csrftoken,
                    },
                    body:JSON.stringify({'productId':productId})
                })
            }
   
   
           // Render the PayPal button into #paypal-button-container
           paypal.Buttons({
   
               // Set up the transaction
               createOrder: function(data, actions) {
                   return actions.order.create({
                       purchase_units: [{ 
                           amount: {
                               value: 200
                           }
                       }]
                   });
               },
   
               // Finalize the transaction
               onApprove: function(data, actions) {
                   return actions.order.capture().then(function(details) {
                       // Show a success message to the buyer
                       completeOrder()
                       alert('Transaction completed by ' + details.payer.name.given_name + '!');
                   });
               }
   
   
           }).render('#paypal-button-container');
       </script>
        
    {% endblock payment_details_content %}
{% endblock payment_details %}